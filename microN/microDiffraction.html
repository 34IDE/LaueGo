<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html40/loose.dtd"><HTML><HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html;charset=UTF-8"><TITLE>Notebook0:microDiffraction.ifn</TITLE><META http-equiv="Content-Style-Type" content="text/css"><META NAME="generator" CONTENT="Igor Pro"></HEAD><BODY STYLE="background:rgb(255,255,255)"><P class=Topic>•&#9;LaueGo, <em>3D-Xray Diffraction</em></P><P class=TopicBody>This is a collection of routines written by Jon Tischler (ORNL) for analysis of microdiffractiondata from sector-34 at the APS.  This help file is specific to the new detector geometry.</P><P class=TopicBody>&#9;&#9;&#9;&#9;<IMG id="Picture0" width=162 height=83 src="./microDiffractionMedia/Picture0.png" alt="Picture0"></P><P class=TopicBody></P><P class=Topic>•&#9;Starting the 'LaueGo Panel'</P><P class=TopicBody>The first step is to load the micro-diffraction procedures. If there is no menu labeled&quot;micro&quot;, then you need to do this.  Select the menu </P><P class=TopicBody>&quot;Analysis-&gt;Packages-&gt;LaueGo [µbeam] -&gt; Select Image Types&quot; this loadsthe basic procedures and will put up the microPanel.  If you are working on Sector 34 (APS) then only select the HDF5 images, otherwise whatever kind of image you are using. If the &quot;LaueGo (micro)&quot;menu already is up, thenselect the menu &quot;LaueGo (micro) -&gt; LaueGo Panel&quot;. You can always do this to retrieve the LaueGo Panelor to bring it to the front.</P><P class=Topic>•&#9;Geometry</P><P class=TopicBody>Berfore almost anything can be done, the calibration parameters also refered to as <a href="#GeometryParameters">geometry parameters</a>are needed.  These can be set from the &quot;LaueGo (micro)&quot; menu, but the easiest way is to use the &quot;Geo&quot; tab on theLaueGo Panel.  When you select the Geo tab, the current geometry parameters are shown.  These geometryparameters describe the location and orientation of all detectors, and also the location and orientationof the scanning wire.  Look at the values in the Geometry panel and decide if they are correct.  If youwant to change them, there are various ways to do that. </P><P class=TopicBody>The simplest way to set the geometry parameters is to load the values from a file. Push the button labeled &quot;Load from a file&quot; and select the appropriate geometry file, it probablystarts with &quot;geo&quot; and ends with &quot;.txt&quot;.  You should have been given a geometry filewith your data.</P><P class=TopicBody></P><P class=TopicBody>&#9;&#9;<IMG id="Picture2" src="./microDiffractionMedia/Picture2.png" alt="Picture2"></P><P class=TopicBody></P><P class=TopicBody>An alternative is to use the web server, this uses a date to fetch the geometry valuesfrom a web server at APS.  Push the button labeled &quot;Load from web&quot;.  A dialog will then comeup asking you to choose an image file.  The program gets the date from this image and then asks the webserver for the latest geometry parameters that were measured earlier than this date.  You can eithersave the values for use, or reject them by pushing Cancel.  If you retrieve the geometry from the web,you shold probably then &quot;Write to a file&quot; too.</P><P class=TopicBody></P><P class=TopicBody>It is also possible to load the geometry values from EPICS, but this is probably disabled,and not too useful anyhow.</P><P class=TopicBody></P><P class=TopicBody>NOTE:  If you change any of the geometry parameters the Save button changes to &quot;SaveDefault (Needed)&quot; and turns green.  So you need to either push the Save button or Cancel (to rejectthe changes).</P><P class=TopicBody></P><P class=TopicBody>The &quot;Save in Current Fldr&quot; button allows you to have these geometry parametersonly apply to the data in the current Igor data folder, you will generaly not want this.</P><P class=TopicBody></P><P class=TopicBody>The button &quot;Write to a file&quot;, writes the current geoemtry values to a textfile that can be later read using the &quot;Load from a file&quot; button</P><P class=TopicBody></P><P class=TopicBody>The final button on this panel is &quot;Print Geo to History&quot;, this prints thecurrent geometry values to the Igor History window.  This is not generally needed, but sometimes useful.</P><P class=TopicBody></P><P class=Topic>•&#9;<a name="GeometryParameters">Geometry Parameters</a></P><P class=TopicBody>Meaning of the geometry parameters:</P><P class=TopicBody></P><P class=TopicBody>First note that the origin is the focus of the x-ray beam and is usualy found using a 4-µm thick piece of Si.  The beam-line coordinate system is X is out the door, Y is up, and Z is alongthe x-ray beam direction.  Except for strain refinement, this is the main <a href="http://www.aps.anl.gov/Sectors/33_34/microdiff/Instrument/coordinates-PE-system.pdf">coordinate system</a>.</P><P class=TopicBody></P><P class=TopicBody>The size of the detector is given by four parameters, (Nx,Ny) are the number of rawun-binned pixels in the entire detector.  The two parameters X(mm) and Y(mm) are the outside dimensionsof the active area (not distance between middle of pixels).  Together these four parameters locate apixel on the detector.</P><P class=TopicBody></P><P class=TopicBody>The detector position(s) are specifed using two vectors R and P.  The base positionof the detector is with the plane of the detector containing the origin, and the detector perpendicularto the incident beam.  The detector is assumed centered on the incident beam with the detectors x-axispointing in the +X direction and y-axis pointing in +Y direction. This is, of course, not a useful locationfor a detector.  The actual detector position is obtained by then doing a translation of vector P followedby a rotation about vector R.  R specifies a rotation about the direction of R, and size of the rotationis |R|, where |R| is in radians.  The translation by P is applied first, followed by the rotation. Theadvantage of this order is that the z component of the P vector gives the distance of the detector centerfrom the origin, and the x and y components show how far off-center of the detector is from a perpendicularline to the origin.  </P><P class=TopicBody></P><P class=TopicBody>The &quot;detector ID&quot; is a string that is unique to a detector and should bestored in each image.  Thus the computer csn associate a detector imsge with its geometry parameters.</P><P class=TopicBody></P><P class=TopicBody>You can use the pop-up in the Geometry panel to view the values for all of the defineddetectors.</P><P class=TopicBody></P><P class=TopicBody>The Scanning wire parameters define the location and orientation of the wire. Althouhprovisions exist for describing the wire as &quot;free-standing&quot; or &quot;knife edge&quot;, onlya free-standing wire exists.  The &quot;wire positioner at origin&quot; is the PM500 position that putsthe wire center on the origin.  The &quot;axis&quot; gives the direction of the wire axis on the PM500(in PM500 units) it will probably be {1,0,0}.  The &quot;wire positioner rotation&quot; gives the orientationof the positioner, since the positioner is probably not perfectly aligned with the beam-line coordiates.</P><P class=TopicBody></P><P class=TopicBody>The Sample parameters can be used to specify the origin of the the sample using thepositioner, but these parameters are generally not used.</P><P class=TopicBody></P><P class=Topic>•&#9;Crystal Structure</P><P class=TopicBody>Before you can index a pattern, you must specify the crystal structuere.  Do thisby choosing the &quot;Xtal&quot; tab in the LaueGo Panel.  Although the numbers can be entered by hand,it is usually best to enter them by selecting the &quot;Load from a file&quot; button.  Remeber to pushthe &quot;Save (Needed)&quot; button to accept the loaded (or changed) lattice values.</P><P class=TopicBody></P><P class=TopicBody>This panel also contains a convienent tool for calculating a d-spacing or atomic structurefactor.  Just enter the h,k,l values and you will see the d-spacing, and F.  The F is calculated assumingthat the atomic structure factor is just the atomic number Z. </P><P class=TopicBody>&#9;&#9;<IMG id="Picture4" src="./microDiffractionMedia/Picture4.png" alt="Picture4"></P><P class=Topic>•&#9;Index a Laue Pattern</P><P class=TopicBody>Select the &quot;Index&quot; tab on the LaueGo Panel, and if you see a button named&quot;Init Indexing package&quot;, push it.</P><P class=TopicBody></P><P class=TopicBody>To index a Laue pattern, the first thing that you must do is load an image to index. So push the &quot;Load Image&quot; button, and select the image that you want to index.  </P><P class=TopicBody>&#9;&#9;<IMG id="Picture5" src="./microDiffractionMedia/Picture5.png" alt="Picture5"></P><P class=TopicBody>Next step you need to identify the peak locations.  Push the &quot;Fit Peaks&quot;button.  This first asks what peak fitting algorithm that you wish to use.  The first choice is &quot;FitPeaks with External&quot; this uses the same C program that is used on the cluster.  The other choicesuse algorithms built into Igor.</P><P class=TopicBody></P><P class=TopicBody>For the &quot;Fit Peaks with External&quot; the following dialog is presented:</P><P class=TopicBody><IMG id="Picture6" src="./microDiffractionMedia/Picture6.png" alt="Picture6"></P><P class=TopicBody>The image is a list of available images that you can fit.</P><P class=TopicBody>The minimum allowed widht of a peak lets you set a minimum peak size.  The 1.13 isfine for a Lorentzian, for a Gaussian peak use 0.2.</P><P class=TopicBody>The boxSize should be big enough to include any peak.  </P><P class=TopicBody>the max R-factor should usualy be left at 0.5 unless you have very good or bad data.</P><P class=TopicBody>The peak shape may be Lorentzian or Gaussian, the Gaussian works best.</P><P class=TopicBody></P><P class=TopicBody>After the peak search has run, push button &quot;±boxes&quot; on the image plot. This button toggles the fitted peak boxes on/off.</P><P class=TopicBody></P><P class=TopicBody>If you don't like the peaks that were found (either too few or too many), you canedit the list of peaks.  To remove a peak from consideration draw a marquee around the offending peak,click in side the marquee to bring up a pop-up menu, and select &quot;Remove Peak from pkList&quot;. To add a peak for consideration, again draw a marquee around the desired peak, click in side the marqueeto bring up a pop-up menu, and select &quot;Add Gaussian to pkList&quot;.  Clicking on the &quot;±boxes&quot;button toggles the boxes around all fitted peaks allowing you see which peaks are being used.</P><P class=TopicBody></P><P class=TopicBody>Now that the peaks have been found, you can index the pattern, use the &quot;Index&amp; Display&quot; button, which puts up the following dialog:</P><P class=TopicBody><IMG id="Picture7" src="./microDiffractionMedia/Picture7.png" alt="Picture7"></P><P class=TopicBody>The popup menu is a list of waves containing fitted peak positions, select the oneyou want.  There will usually be only one choice.</P><P class=TopicBody></P><P class=TopicBody>The indexing algorithm constructs a list of possilble hkl's and compares the anglesbetween the calcualted hkl's with the angles between measured q vectors.   The list of hkl's is createdusing the &quot;preferred hkl of center&quot;, &quot;max angle° from hkl prefer&quot;, and &quot;maxenergy for searcing&quot;  The &quot;preferred hkl of center&quot; and &quot;max angle° from hkl prefer&quot;specify a cone.  All hkl in that cone are used, such that the Bragg reflection has an energy below the&quot;max energy&quot;.  There are two &quot;max energy&quot;s. The &quot;max energy for searching&quot;is used when finding the sample orientation.  After the orientation is found, the &quot;max energy formatching&quot; is used to select which measured peaks belong to that pattern.  So the &quot;max energyfor matching&quot; should usualy be limited to 32 keV, and the &quot;max energy for searching&quot; shouldnot be too big, or there will be too many hkl pairs to consider.  The &quot;max angle between peak &amp;hkl&quot; specifies the angular tolerance used when finding an orientation and when choosing which measuredpeaks are part of a pattern.</P><P class=TopicBody></P><P class=TopicBody>Note, the indexing routine may find more than one pattern in the Laue picture.  Ifthat happens, then you will be able to view any one of the identified patterns.  To view the result ofan indexing on the image, select the pop list &quot;hkl Tags...&quot;.  This will allow you to see theresult of the indexing, or view missing peaks.</P><P class=TopicBody></P><P class=TopicBody>Now that you know the orientation of the sample, you can also get an oriented StereographicProjection, or calculate the energy of any hkl.  For a Stereographic Projection use the button (you mayhave to push it twice the first time).  For the energy of an hkl, set the H,K,L, and push &quot;CalcEnergy of (hkl)&quot;.  </P><P class=TopicBody></P><P class=TopicBody>You may also automatically produce a report sheet that shows the indexed Laue patternand information about most of the peaks.  Push the button labeled &quot;Report&quot;, and print it.</P><P class=TopicBody></P><P class=TopicBody>Display Tables...</P><P class=TopicBody>There is also a popup &quot;Display Tables...&quot; which will allow you to easilysee tables of information concerning fitted peaks, indexed peaks, strain refined peak, ...</P><P class=TopicBody></P><P class=TopicBody></P><P class=TopicBody>Mousing around:</P><P class=TopicBody>Once the Laue image has been indexed, you can get information about it using the mouse. </P><P class=TopicBody></P><P class=TopicBody>Info about indexed peaks:  Hold down the Shift key and move the mouse over the plot.</P><P class=TopicBody>Info about fitted peaks:  Hold down the Command (apple) key and move the mouse overthe plot.</P><P class=TopicBody></P><P class=TopicBody>Info about any location:  Hold down the Command key and hold down the mouse whilemoving the mouse. This even works before you have indexed.</P><P class=TopicBody></P><P class=TopicBody>Info about any Strain Refinement:  Hold down the Shift &amp; Command keys and mouseover the plot.  This will only work after you have done a strain refinement.</P><P class=TopicBody></P><P class=TopicBody></P><P class=Topic>•&#9;Strain Refinement</P><P class=TopicBody>Push the &quot;Strain Refine&quot; button.  The following dialog appear:</P><P class=TopicBody>&#9;&#9;<IMG id="Picture8" src="./microDiffractionMedia/Picture8.png" alt="Picture8"></P><P class=TopicBody>Select which parameters you want to refine and push &quot;Go&quot;.  Note that youcannot refine all three lengts (a,b, &amp; c) since you have only collected angular information.  Themost you can get is the deviatoric strain.  Since this program does not know the length of q vectors,when computing the strain it always preserves the volume of the unit cell when strain refinemening.</P><P class=TopicBody></P><P class=TopicBody></P><P class=TopicBody></P><P class=TopicBody></P><P class=Topic>•&#9;Details tab</P><P class=TopicBody>The Details tab allows you to make movies of many kinds of data, and show some commonlycomputed information.  The &quot;Load Recon Summary&quot; loads the summary file from a depth reconstruction. With the reconstructed images from each wire scan you will find a text file with a name like &quot;WW_1_summary.txt&quot;. This file sumarizes the result of a wire scan.  The button &quot;Load Recon Summary&quot; will selecta summary file, load it, and display the total intensity vs. depth for that wire scan.  If you need tore-plot the intensity vs. depth for a loaded summary use the following button &quot;Re-Plot Summary&quot;.</P><P class=TopicBody></P><P class=Topic>•&#9;Energy Scans</P><P class=TopicBody>The &quot;E scans&quot; tab in the mocroPanel&quot; is used for data that was takenby scanning energy.  It's main function is to make Q-distrbutions.  </P><P class=TopicBody></P><P class=TopicBody>First you must push the &quot;Set UpNew E-W scan...&quot;. </P><P class=TopicBody>&#9;Enter a title for you plots</P><P class=TopicBody>&#9;Enter a d-spacing (needed to calulate strain, optional)</P><P class=TopicBody>&#9;make up a folder name, something short and without spaces.</P><P class=TopicBody>&#9;PUSH the button labeled &quot;Enter Values, then click here&quot; !!!</P><P class=TopicBody></P><P class=TopicBody>If you do not know the preferred d-spacing, just leave it as &quot;Inf&quot;.</P><P class=TopicBody></P><P class=TopicBody>You can now create a Q-distribution by pushing &quot;Make Q-Depth Surface&quot;</P><P class=TopicBody></P><P class=TopicBody>Masking</P><P class=TopicBody>Sometimes when evaluating a Q-distribution, it is desirable to only process part ofan image, e.g. only get the Q-distribution for those pixels near a particular peak.  The way to do thisis by maskigng.  First you need to get a &quot;white&quot; beam image. Since you probably only have anenergy scan, just use the &quot;Make a Pseudo White Image&quot; to add up all of the measured energiesto make a &quot;white&quot; image.  Second push the &quot;Make a Mask&quot; and select the white beamimage.  Using the marquee you can add or subtract pixels from the mask.  You can also use the &quot;NewFreehand&quot; button in the top left of the mask image to select pixels using a freehand curve.  Whenyou are done setting the pixels, simply close the image plot (push the red dot at top left corner) tofinish making the mask.  Note that the top of this window says &quot;Close Me When Done&quot;.  If youwish to change a mask, just push the &quot;Make a Mask&quot; button again and you will be prompted fora mask to edit.</P><P class=TopicBody></P><P class=Topic>•&#9;Laue Simulation</P><P class=TopicBody>The &quot;Laue Sim.&quot; tab.  This makes a simulated Laue pattern.  If you havealready indexed the pattern the Laue pattern should be oriented with the simulated indexed pattern.</P><P class=TopicBody></P><P class=Topic>•&#9;Calibration</P><P class=TopicBody>Used for calibrating the detectors, and producing the geometry parameters.</P><P class=TopicBody></P><P class=Topic>•&#9;OLD Geometry</P><P class=TopicBody></P><P class=Topic>•&#9;Distortion Correction for</P><P class=TopicBody>The CCD is not spatially linear; there is some distortion (similar to a pin cushiondistortion present in some optics).  This can be corrected, and must be corrected for high precisiondata (especially for strain data).  To change this or to determine whether it is being done, go to the&quot;micro&quot; menu which allows you to view the status of the Distortion Correction and to turn ison or off.</P><P class=Topic>•&#9;old geometry</P><P class=TopicBody>The geometry parameters are the numbers that describe the relative position an angleof all of the components.  This includes the detector position and angle, the incident beam, and thewire.</P><P class=TopicBody>They can be set from the mneu &quot;micro-&gt;Set Geometry Parameters...&quot;.  Youcan either type in the numbers, load the current EPICS values, or load from a geometry file.  </P><P class=TopicBody></P><P class=TopicBody>Beam Line coordinate system, Z along beam, X out the hutch door, Y is up</P><P class=TopicBody>Detector coordinage system, Z is up along direction of CCDy, X is out the door, Yalong y pixels on CCD</P><P class=TopicBody></P><P class=Subtopic>&#9;incident beam:</P><P class=TopicBody-2>xbeta, xgamma&#9;tilt of the incident beam beta is up/down, gam is left right</P><P class=TopicBody></P><P class=Subtopic>&#9;detector:</P><P class=TopicBody-2>NxCCD, NyCCD&#9;number of pixels in a full unbinned image</P><P class=TopicBody-2>dpsx, dpsy&#9;&#9;size of the CCD in mm</P><P class=TopicBody-2>xalphad,xbetad&#9;tilt of the CCD </P><P class=TopicBody-2>xcent,ycent&#9;&#9;pixel directly above source (up is along CCDy)</P><P class=TopicBody-2>dd&#9;&#9;&#9;height of (xcent,ycent) above beam</P><P class=TopicBody-2>ddOffset&#9;&#9;dd = CCDy+ddOffset (a correction between dd and CCDy)</P><P class=TopicBody></P><P class=Subtopic>&#9;wire:</P><P class=TopicBody-2>wire dia&#9;&#9;diameter of wire (µm)</P><P class=TopicBody-2>wire H0&#9;&#9;H when wire intersects the incident beam</P><P class=TopicBody-2>wire Hyc&#9;&#9;H when wire intersects beam from sample to (xcent,ycent)</P><P class=TopicBody-2>wire F&#9;&#9;F used for H0 and Hyc</P><P class=TopicBody>&#9;&#9;<IMG id="Picture9" src="./microDiffractionMedia/Picture9.png" alt="Picture9"></P></BODY></HTML>